{"ast":null,"code":"function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { CognitoUserPool, AuthenticationDetails, CognitoUser, CookieStorage } from \"amazon-cognito-identity-js\";\n\nfunction toObject(array) {\n  let values = {};\n\n  for (let i = 0; array.length > i; i++) {\n    values = _objectSpread(_objectSpread({}, values), {}, {\n      [array[i].getName()]: array[i].getValue()\n    });\n  }\n\n  return values;\n}\n\nexport const createUser = (() => {\n  let userPool = new CognitoUserPool({\n    UserPoolId: process.env.NEXT_PUBLIC_COGNITO_POOL_ID,\n    ClientId: process.env.NEXT_PUBLIC_COGNITO_CLIENT_ID,\n    Storage: new CookieStorage({\n      domain: process.env.NEXT_PUBLIC_DOMAIN,\n      secure: false,\n      path: \"/\"\n    })\n  });\n  return {\n    signup: (firstname, lastname, email, password) => {\n      var attributeList = [];\n      var dataName = {\n        Name: \"name\",\n        Value: firstname\n      };\n      var dataFamilyName = {\n        Name: \"family_name\",\n        Value: lastname\n      };\n      var attributeName = new CognitoUserAttribute(dataName);\n      var attributeFamilyName = new CognitoUserAttribute(dataFamilyName);\n      attributeList.push(attributeName);\n      attributeList.push(attributeFamilyName);\n      return new Promise((resolve, reject) => {\n        userPool.signUp(email, password, attributeList, null, function (err, result) {\n          if (err) {\n            reject(err);\n            return;\n          }\n\n          resolve(result.user);\n        });\n      });\n    },\n    confirm: (email, code) => {\n      var userData = {\n        Username: email,\n        Pool: userPool\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.confirmRegistration(code, true, function (err, result) {\n          if (err) {\n            reject(err);\n            return;\n          }\n\n          resolve(result);\n        });\n      });\n    },\n    resend: email => {\n      var userData = {\n        Username: email,\n        Pool: userPool\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.resendConfirmationCode(function (err, result) {\n          if (err) {\n            reject(err);\n            return;\n          }\n\n          resolve(result);\n        });\n      });\n    },\n    signin: (email, password, req) => {\n      var authenticationData = {\n        Username: email,\n        Password: password\n      };\n      var authenticationDetails = new AuthenticationDetails(authenticationData);\n      var userData = {\n        Username: email,\n        Pool: userPool,\n        Storage: new CookieStorage({\n          domain: process.env.NEXT_PUBLIC_DOMAIN,\n          secure: false\n        })\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.authenticateUser(authenticationDetails, {\n          onSuccess: result => {\n            resolve(result);\n          },\n          onFailure: err => reject(err)\n        });\n      });\n    },\n    current: () => {\n      return userPool.getCurrentUser();\n    },\n    hasSession: () => {\n      return new Promise((resolve, reject) => {\n        const user = userPool.getCurrentUser();\n        if (!user) resolve(false);\n        user.getSession((err, session) => {\n          console.log(session);\n          return err ? reject(false) : session.isValid() ? resolve(true) : reject(false);\n        });\n      });\n    },\n    logout: cb => {\n      return new Promise((resolve, reject) => {\n        const user = userPool.getCurrentUser();\n        if (!user) reject(\"User is not defined\");\n        resolve(user.signOut());\n      });\n    }\n  };\n})();\n/**\n * user.getUserAttributes(function (err, attributes) {\n            if (err) {\n              reject(false, null)\n            } else {\n              resolve({\n                connected: true,\n                user: toObject(attributes)\n              })\n            }\n          });\n */","map":{"version":3,"sources":["/Users/benjamin/Desktop/perso/ventejob/services/auth.js"],"names":["CognitoUserPool","AuthenticationDetails","CognitoUser","CookieStorage","toObject","array","values","i","length","getName","getValue","createUser","userPool","UserPoolId","process","env","NEXT_PUBLIC_COGNITO_POOL_ID","ClientId","NEXT_PUBLIC_COGNITO_CLIENT_ID","Storage","domain","NEXT_PUBLIC_DOMAIN","secure","path","signup","firstname","lastname","email","password","attributeList","dataName","Name","Value","dataFamilyName","attributeName","CognitoUserAttribute","attributeFamilyName","push","Promise","resolve","reject","signUp","err","result","user","confirm","code","userData","Username","Pool","cognitoUser","confirmRegistration","resend","resendConfirmationCode","signin","req","authenticationData","Password","authenticationDetails","authenticateUser","onSuccess","onFailure","current","getCurrentUser","hasSession","getSession","session","console","log","isValid","logout","cb","signOut"],"mappings":"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","sourcesContent":["import {\n  CognitoUserPool,\n  AuthenticationDetails,\n  CognitoUser,\n  CookieStorage,\n} from \"amazon-cognito-identity-js\";\n\nfunction toObject(array) {\n  let values = {};\n  for (let i = 0; array.length > i; i++) {\n    values = {\n      ...values,\n      [array[i].getName()]: array[i].getValue(),\n    };\n  }\n  return values;\n}\n\nexport const createUser = (() => {\n  let userPool = new CognitoUserPool({\n    UserPoolId: process.env.NEXT_PUBLIC_COGNITO_POOL_ID,\n    ClientId: process.env.NEXT_PUBLIC_COGNITO_CLIENT_ID,\n    Storage: new CookieStorage({\n      domain: process.env.NEXT_PUBLIC_DOMAIN,\n      secure: false,\n      path: \"/\",\n    }),\n  });\n  return {\n    signup: (firstname, lastname, email, password) => {\n      var attributeList = [];\n      var dataName = {\n        Name: \"name\",\n        Value: firstname,\n      };\n\n      var dataFamilyName = {\n        Name: \"family_name\",\n        Value: lastname,\n      };\n      var attributeName = new CognitoUserAttribute(dataName);\n      var attributeFamilyName = new CognitoUserAttribute(dataFamilyName);\n      attributeList.push(attributeName);\n      attributeList.push(attributeFamilyName);\n      return new Promise((resolve, reject) => {\n        userPool.signUp(email, password, attributeList, null, function (\n          err,\n          result\n        ) {\n          if (err) {\n            reject(err);\n            return;\n          }\n          resolve(result.user);\n        });\n      });\n    },\n    confirm: (email, code) => {\n      var userData = {\n        Username: email,\n        Pool: userPool,\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.confirmRegistration(code, true, function (err, result) {\n          if (err) {\n            reject(err);\n            return;\n          }\n          resolve(result);\n        });\n      });\n    },\n    resend: (email) => {\n      var userData = {\n        Username: email,\n        Pool: userPool,\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.resendConfirmationCode(function (err, result) {\n          if (err) {\n            reject(err);\n            return;\n          }\n          resolve(result);\n        });\n      });\n    },\n    signin: (email, password, req) => {\n      var authenticationData = {\n        Username: email,\n        Password: password,\n      };\n      var authenticationDetails = new AuthenticationDetails(authenticationData);\n      var userData = {\n        Username: email,\n        Pool: userPool,\n        Storage: new CookieStorage({\n          domain: process.env.NEXT_PUBLIC_DOMAIN,\n          secure: false,\n        }),\n      };\n      var cognitoUser = new CognitoUser(userData);\n      return new Promise((resolve, reject) => {\n        cognitoUser.authenticateUser(authenticationDetails, {\n          onSuccess: (result) => {\n            resolve(result);\n          },\n          onFailure: (err) => reject(err),\n        });\n      });\n    },\n    current: () => {\n      return userPool.getCurrentUser();\n    },\n    hasSession: () => {\n      return new Promise((resolve, reject) => {\n        const user = userPool.getCurrentUser();\n        if (!user) resolve(false);\n        user.getSession((err, session) => {\n          console.log(session);\n          return err\n            ? reject(false)\n            : session.isValid()\n            ? resolve(true)\n            : reject(false);\n        });\n      });\n    },\n    logout: (cb) => {\n      return new Promise((resolve, reject) => {\n        const user = userPool.getCurrentUser();\n        if (!user) reject(\"User is not defined\");\n        resolve(user.signOut());\n      });\n    },\n  };\n})();\n\n/**\n * user.getUserAttributes(function (err, attributes) {\n            if (err) {\n              reject(false, null)\n            } else {\n              resolve({\n                connected: true,\n                user: toObject(attributes)\n              })\n            }\n          });\n */\n"]},"metadata":{},"sourceType":"module"}