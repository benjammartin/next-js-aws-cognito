{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"/Users/benjamin/Desktop/perso/ventejob/modules/auth/components/UserContext.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nvar __jsx = React.createElement;\nimport React, { createContext, useContext } from \"react\";\nimport { useQuery, useMutation, queryCache } from \"react-query\";\nimport { createUser } from \"services/auth\";\nimport Router from \"next/router\";\nvar User = createContext(null);\n\nfunction AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  function Logout() {\n    return _Logout.apply(this, arguments);\n  }\n\n  function _Logout() {\n    _Logout = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return createUser.logout();\n\n            case 2:\n              return _context.abrupt(\"return\", _context.sent);\n\n            case 3:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _Logout.apply(this, arguments);\n  }\n\n  var _useMutation = useMutation(Logout, {\n    onSuccess: function onSuccess() {\n      queryCache.refetchQueries(\"hassession\").then(function () {\n        return Router.push(\"/auth/signin\");\n      });\n    },\n    onError: function onError(e) {\n      console.log(e);\n    }\n  }),\n      _useMutation2 = _slicedToArray(_useMutation, 2),\n      mutate = _useMutation2[0],\n      _useMutation2$ = _useMutation2[1],\n      status = _useMutation2$.status,\n      data = _useMutation2$.data;\n\n  console.log(status);\n\n  function hasSession() {\n    return _hasSession.apply(this, arguments);\n  }\n\n  function _hasSession() {\n    _hasSession = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return createUser.hasSession();\n\n            case 2:\n              return _context2.abrupt(\"return\", _context2.sent);\n\n            case 3:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n    return _hasSession.apply(this, arguments);\n  }\n\n  var _useQuery = useQuery(\"hassession\", hasSession),\n      session = _useQuery.data;\n\n  console.log(session);\n  return __jsx(User.Provider, {\n    value: [session, function () {\n      return mutate();\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 34,\n      columnNumber: 5\n    }\n  }, children);\n}\n\n_s(AuthProvider, \"CjDg12ke/AhuxmJD3U2Z0t+z1j0=\", false, function () {\n  return [useMutation, useQuery];\n});\n\n_c = AuthProvider;\nexport var useAuth = function useAuth() {\n  _s2();\n\n  return useContext(User);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport default AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Users/benjamin/Desktop/perso/ventejob/modules/auth/components/UserContext.jsx"],"names":["React","createContext","useContext","useQuery","useMutation","queryCache","createUser","Router","User","AuthProvider","children","Logout","logout","onSuccess","refetchQueries","then","push","onError","e","console","log","mutate","status","data","hasSession","session","useAuth"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,UAA/B,QAAiD,OAAjD;AACA,SAASC,QAAT,EAAmBC,WAAnB,EAAgCC,UAAhC,QAAkD,aAAlD;AACA,SAASC,UAAT,QAA2B,eAA3B;AACA,OAAOC,MAAP,MAAmB,aAAnB;AAEA,IAAMC,IAAI,GAAGP,aAAa,CAAC,IAAD,CAA1B;;AAEA,SAASQ,YAAT,OAAoC;AAAA;;AAAA,MAAZC,QAAY,QAAZA,QAAY;;AAAA,WACnBC,MADmB;AAAA;AAAA;;AAAA;AAAA,uEAClC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACeL,UAAU,CAACM,MAAX,EADf;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADkC;AAAA;AAAA;;AAAA,qBAKCR,WAAW,CAACO,MAAD,EAAS;AACrDE,IAAAA,SAAS,EAAE,qBAAM;AACfR,MAAAA,UAAU,CACPS,cADH,CACkB,YADlB,EAEGC,IAFH,CAEQ;AAAA,eAAMR,MAAM,CAACS,IAAP,CAAY,cAAZ,CAAN;AAAA,OAFR;AAGD,KALoD;AAMrDC,IAAAA,OAAO,EAAE,iBAACC,CAAD,EAAO;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,CAAZ;AACD;AARoD,GAAT,CALZ;AAAA;AAAA,MAK3BG,MAL2B;AAAA;AAAA,MAKjBC,MALiB,kBAKjBA,MALiB;AAAA,MAKTC,IALS,kBAKTA,IALS;;AAgBlCJ,EAAAA,OAAO,CAACC,GAAR,CAAYE,MAAZ;;AAhBkC,WAkBnBE,UAlBmB;AAAA;AAAA;;AAAA;AAAA,2EAkBlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACelB,UAAU,CAACkB,UAAX,EADf;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAlBkC;AAAA;AAAA;;AAAA,kBAqBRrB,QAAQ,CAAC,YAAD,EAAeqB,UAAf,CArBA;AAAA,MAqBpBC,OArBoB,aAqB1BF,IArB0B;;AAuBlCJ,EAAAA,OAAO,CAACC,GAAR,CAAYK,OAAZ;AAEA,SACE,MAAC,IAAD,CAAM,QAAN;AAAe,IAAA,KAAK,EAAE,CAACA,OAAD,EAAU;AAAA,aAAMJ,MAAM,EAAZ;AAAA,KAAV,CAAtB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAkDX,QAAlD,CADF;AAGD;;GA5BQD,Y;UAK4BL,W,EAgBTD,Q;;;KArBnBM,Y;AA8BT,OAAO,IAAMiB,OAAO,GAAG,SAAVA,OAAU;AAAA;;AAAA,SAAMxB,UAAU,CAACM,IAAD,CAAhB;AAAA,CAAhB;;IAAMkB,O;;AACb,eAAejB,YAAf","sourcesContent":["import React, { createContext, useContext } from \"react\";\nimport { useQuery, useMutation, queryCache } from \"react-query\";\nimport { createUser } from \"services/auth\";\nimport Router from \"next/router\";\n\nconst User = createContext(null);\n\nfunction AuthProvider({ children }) {\n  async function Logout() {\n    return await createUser.logout();\n  }\n\n  const [mutate, { status, data }] = useMutation(Logout, {\n    onSuccess: () => {\n      queryCache\n        .refetchQueries(\"hassession\")\n        .then(() => Router.push(\"/auth/signin\"));\n    },\n    onError: (e) => {\n      console.log(e);\n    },\n  });\n\n  console.log(status);\n\n  async function hasSession() {\n    return await createUser.hasSession();\n  }\n  const { data: session } = useQuery(\"hassession\", hasSession);\n\n  console.log(session);\n\n  return (\n    <User.Provider value={[session, () => mutate()]}>{children}</User.Provider>\n  );\n}\n\nexport const useAuth = () => useContext(User);\nexport default AuthProvider;\n"]},"metadata":{},"sourceType":"module"}